{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">

    <!-- Facility Filter -->
    <div class="mb-4">
        <form method="get" class="d-flex">
            <label for="facility" class="me-2">Select Facility:</label>
            <select name="facility" id="facility" class="form-select w-auto" onchange="this.form.submit()">
                <option value="">All Facilities</option>
                {% for facility in facilities %}
                    <option value="{{ facility.id }}"
                        {% if facility.id|stringformat:"s" == selected_facility %}
                        selected
                        {% endif %}
                    >
                        {{ facility.name }}
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>

    <!-- Dashboard Cards -->
    <div class="row g-3">

        <!-- Daily Expected -->
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3 shadow">
                <div class="card-body text-center">
                    <h6 class="card-title">Today's Expected</h6>
                    <h2 class="card-text">{{ daily_expected.count }}</h2>
                </div>
            </div>
        </div>

        <!-- Daily Refills -->
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3 shadow">
                <div class="card-body text-center">
                    <h6 class="card-title">Today's Refill</h6>
                    <h2 class="card-text">{{ daily_refills.count }}</h2>
                </div>
            </div>
        </div>

        <!-- Monthly Missed -->
        <div class="col-md-3">
            <div class="card text-white bg-danger mb-3 shadow">
                <div class="card-body text-center">
                    <h6 class="card-title">Missed This Month</h6>
                    <h2 class="card-text">{{ monthly_missed_total }}</h2>
                </div>
            </div>
        </div>

        <!-- IIT -->
        <div class="col-md-3">
            <div class="card text-white bg-dark mb-3 shadow border-danger">
                <div class="card-body text-center">
                    <h6 class="card-title">IIT (â‰¥ 28 Days)</h6>
                    <h2 class="card-text text-danger fw-bold">
                        {{ iit_total }}
                    </h2>
                </div>
            </div>
        </div>

        <!-- Weekly Expected -->
        <div class="col-md-3">
            <div class="card text-white bg-info mb-3 shadow">
                <div class="card-body text-center">
                    <h6 class="card-title">Weekly Expected</h6>
                    <h2 class="card-text">{{ weekly_expected.count }}</h2>
                </div>
            </div>
        </div>

        <!-- Monthly Expected -->
        <div class="col-md-3">
            <div class="card text-dark bg-warning mb-3 shadow">
                <div class="card-body text-center">
                    <h6 class="card-title">Monthly Expected</h6>
                    <h2 class="card-text">{{ monthly_expected.count }}</h2>
                </div>
            </div>
        </div>

        <!-- ============================= -->
        <!-- ðŸ”¥ NEW VIRAL LOAD CARDS ðŸ”¥ -->
        <!-- ============================= -->

        <!-- VL Eligible (Denominator) -->
        <div class="col-md-3">
            <div class="card text-white bg-secondary mb-3 shadow">
                <div class="card-body text-center">
                    <h6 class="card-title">
                        VL Eligible ({{ current_quarter }} {{ current_year }})
                    </h6>
                    <h2 class="card-text">
                        {{ vl_denominator }}
                    </h2>
                </div>
            </div>
        </div>

        <!-- VL Collected (Numerator) -->
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3 shadow">
                <div class="card-body text-center">
                    <h6 class="card-title">
                        VL Collected ({{ current_quarter }} {{ current_year }})
                    </h6>
                    <h2 class="card-text">
                        {{ vl_numerator }}
                    </h2>
                </div>
            </div>
        </div>

        <!-- VL Coverage % -->
        <div class="col-md-3">
            <div class="card text-white bg-dark mb-3 shadow border-success">
                <div class="card-body text-center">
                    <h6 class="card-title">
                        VL Coverage %
                    </h6>
                    <h2 class="card-text fw-bold text-success">
                        {{ vl_coverage }}%
                    </h2>
                </div>
            </div>
        </div>


        <!-- VL Suppression -->
    


    </div>

</div>
{% endblock content %}
